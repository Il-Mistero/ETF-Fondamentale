<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fondamentale</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0a0c9;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .status-bar {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 12px 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 30px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            width: 300px;
            font-size: 14px;
        }

        .search-box::placeholder {
            color: #a0a0c9;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
        }

        .table-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(102, 126, 234, 0.2);
            backdrop-filter: blur(10px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
        }

        th, td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }

        th {
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        th:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .sort-arrow {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
            font-size: 12px;
        }

        tbody tr {
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .ticker {
            font-family: monospace;
            font-weight: 600;
            color: #667eea;
        }

        .price {
            font-weight: 600;
            font-family: monospace;
        }

        .status-undervalued {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-overvalued {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .percentage {
            font-weight: 600;
            font-family: monospace;
        }

        .percentage.positive {
            color: #4ade80;
        }

        .percentage.negative {
            color: #f87171;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #a0a0c9;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: #a0a0c9;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            th, td {
                padding: 10px 8px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Fondamentale</h1>
            <p class="subtitle">Real-time stock analysis with multiple valuation models</p>
            <div class="status-bar">
                <div class="status-dot"></div>
                <span>Real-time Data â€¢ Click refresh to update</span>
            </div>
        </header>

        <div class="controls">
            <input type="text" class="search-box" placeholder="Search stocks..." id="searchInput">
            <button class="refresh-btn" onclick="refreshData()">ðŸ”„ Refresh Data</button>
        </div>

        <div class="table-container">
            <table id="stockTable">
                <thead>
                    <tr>
                        <th onclick="sortTable(0)">Company Name <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(1)">Ticker <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(2)">DCF Value <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(3)">P/E Value <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(4)">Asset Value <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(5)">Current Price <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(6)">Status <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(7)">% Difference <span class="sort-arrow">â†•</span></th>
                    </tr>
                </thead>
                <tbody id="stockTableBody">
                    <tr>
                        <td colspan="8" class="loading">
                            <div class="spinner"></div>
                            Loading stock data...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <footer class="footer">
            <p>Click refresh button to update data â€¢ Powered by Yahoo Finance API</p>
            <p>Disclaimer: This is for educational purposes only. Not financial advice.</p>
        </footer>
    </div>

    <script>
        // Real Yahoo Finance data integration via Vercel API
        let stockData = [];
        let sortColumn = 8;
        let sortDirection = -1; // -1 for descending, 1 for ascending

        const API_BASE_URL = 'https://etf-fondamentale-dh4p.vercel.app/api';

        const stockSymbols = [
            'VOO', 'IVV', 'SPY', 'VTI', 'QQQ', 'VUG', 'VEA', 'IEFA', 'VTV', 'BND', 'AGG', 'IWF', 'IWDA', 'GLD', 'VXUS', 'IEMG', 'VGT', 'IJH', 'VWO', 'VIG', 'VO', 'IJR', 'IBIT', 'SPLG', 'XLK', 'ITOT', 'RSP', 'SCHD', 'BNDX', 'VB', 'IWM', 'EFA', 'VYM', 'IVW', 'IWD', 'SCHX', 'QQQM', 'VCIT', 'SGOV', 'QUAL', 'XLF', 'IAU', 'VT', 'SCHF', 'VEU', 'SCHG', 'VUSD', 'VUSA', 'XLE', 'XLV', 'XLY', 'XLI', 'XLB', 'XLU', 'XLRE', 'XLC', 'XLP', 'TLT', 'IEF', 'SHY', 'TIP', 'LQD', 'HYG', 'JNK', 'EEM', 'FXI', 'EWJ', 'EWT', 'EWG', 'EWU', 'EWZ', 'EWH', 'EWY', 'EWS', 'EWQ', 'EWA', 'EWP', 'EWL', 'EWO', 'ARKK', 'ARKW', 'ARKG', 'ARKQ', 'ARKF', 'ARKU', 'TQQQ', 'SQQQ', 'UPRO', 'SPXU', 'TNA', 'TZA', 'SOXL', 'SOXS', 'LABU', 'LABD', 'NUGT', 'DUST', 'BITO', 'GBTC', 'VYM', 'DVY', 'SDY', 'RDVY', 'VIGI', 'JEPI', 'JEPQ', 'SPYI', 'DIVO', 'XDTE', 'XYLD', 'RYLD', 'SRLN', 'FLOT', 'MINT', 'JPST', 'BIL', 'ICSH', 'TFI', 'PFF', 'PSP', 'REET', 'VNQ', 'IYR', 'SCHH', 'FREL', 'KBWY', 'ICF', 'ITA', 'PPA', 'XAR', 'DFJ', 'KWEB', 'FLIN', 'INDA', 'EIDO', 'THD', 'EPHE', 'ECH', 'ILF', 'EWIV', 'ASHR', 'MCHI', 'TAWK', 'RSX', 'EURL', 'VGK', 'VG', 'ACWX', 'IXUS', 'SCHE', 'VPL', 'VSS', 'DEM', 'DGS', 'EDIV', 'DVYE', 'DWM', 'PIE', 'PXF', 'SPDW', 'GXG', 'FEM', 'AFK', 'NGE', 'LIT', 'REMX', 'TAN', 'ICLN', 'FAN', 'PBD', 'ARKK', 'CQQQ', 'KARS', 'BUG', 'HACK', 'WCBR', 'AIQ', 'BOTZ', 'ROBO', 'IRBO', 'THNQ', 'QTEC', 'FTEC', 'IYW', 'ROM', 'PSI', 'CQQQ', 'SMH', 'XSD', 'SSG', 'FTXL', 'XME', 'SLX', 'PICK', 'XHB', 'IYT', 'XTN', 'CARZ', 'DRIV', 'EVLV', 'IDRV', 'DRIV', 'KARS', 'CARS', 'EVAV', 'BATT', 'LIT', 'ALMM', 'TMDX', 'IDNA', 'XBI', 'IBB', 'PSCH', 'PJP', 'XPH', 'VHT', 'FHLC', 'IXJ', 'IHI', 'XHE', 'SBIO', 'GNOM', 'ARKG', 'EDOC', 'CURE', 'RXD', 'BIS', 'LABU', 'DIRT', 'SOIL', 'URA', 'NLR', 'PUI', 'FAN', 'TAN', 'ICLN', 'QCLN', 'PBW', 'GRID', 'ACDC', 'FFTY', 'KURE', 'MJ', 'YOLO', 'TOKE', 'MSOS', 'YINN', 'YANG', 'BOIL', 'KOLD', 'UCO', 'SCO', 'USO', 'BNO', 'DBA', 'DJP', 'PDBC', 'GUNR', 'NANR', 'WOOD', 'CUT', 'PICK', 'SLX', 'XME', 'MOO', 'VCR', 'XLY', 'RTH', 'XRT', 'RCD', 'IYC', 'PEJ', 'PBS', 'XLP', 'VDC', 'IYK', 'KXI', 'PBJ', 'TAP', 'XLP', 'XLI', 'VIS', 'PAV', 'XAR', 'ITA', 'PPA', 'FXR', 'XTN', 'SEA', 'CARZ', 'DRIV', 'EVAV', 'BATT', 'ALMM', 'REMX', 'LIT', 'TMDX', 'IDNA'


        ];

const companyNames = {
            'VOO': 'Vanguard S&P 500 ETF', 'IVV': 'iShares Core S&P 500 ETF', 'SPY': 'SPDR S&P 500 ETF Trust', 'VTI': 'Vanguard Total Stock Market ETF', 'QQQ': 'Invesco QQQ Trust', 'VUG': 'Vanguard Growth ETF', 'VEA': 'Vanguard FTSE Developed Markets ETF', 'IEFA': 'iShares Core MSCI EAFE ETF', 'VTV': 'Vanguard Value ETF', 'BND': 'Vanguard Total Bond Market ETF', 'AGG': 'iShares Core U.S. Aggregate Bond ETF', 'IWF': 'iShares Russell 1000 Growth ETF', 'IWDA': 'iShares Core MSCI World UCITS ETF', 'GLD': 'SPDR Gold Shares', 'VXUS': 'Vanguard Total International Stock ETF', 'IEMG': 'iShares Core MSCI Emerging Markets ETF', 'VGT': 'Vanguard Information Technology ETF', 'IJH': 'iShares Core S&P Mid-Cap ETF', 'VWO': 'Vanguard FTSE Emerging Markets ETF', 'VIG': 'Vanguard Dividend Appreciation ETF', 'VO': 'Vanguard Mid-Cap ETF', 'IJR': 'iShares Core S&P Small-Cap ETF', 'IBIT': 'iShares Bitcoin Trust ETF', 'SPLG': 'SPDR Portfolio S&P 500 ETF', 'XLK': 'Technology Select Sector SPDR Fund', 'ITOT': 'iShares Core S&P Total U.S. Stock Market ETF', 'RSP': 'Invesco S&P 500 Equal Weight ETF', 'SCHD': 'Schwab U.S. Dividend Equity ETF', 'BNDX': 'Vanguard Total International Bond ETF', 'VB': 'Vanguard Small-Cap ETF', 'IWM': 'iShares Russell 2000 ETF', 'EFA': 'iShares MSCI EAFE ETF', 'VYM': 'Vanguard High Dividend Yield ETF', 'IVW': 'iShares S&P 500 Growth ETF', 'IWD': 'iShares Russell 1000 Value ETF', 'SCHX': 'Schwab U.S. Large-Cap ETF', 'QQQM': 'Invesco NASDAQ 100 ETF', 'VCIT': 'Vanguard Intermediate-Term Corporate Bond ETF', 'SGOV': 'iShares 0-3 Month Treasury Bond ETF', 'QUAL': 'iShares MSCI USA Quality Factor ETF', 'XLF': 'Financial Select Sector SPDR Fund', 'IAU': 'iShares Gold Trust', 'VT': 'Vanguard Total World Stock ETF', 'SCHF': 'Schwab International Equity ETF', 'VEU': 'Vanguard FTSE All-World ex-US ETF', 'SCHG': 'Schwab U.S. Large-Cap Growth ETF', 'VUSD': 'Vanguard S&P 500 UCITS ETF USD Accumulation', 'VUSA': 'Vanguard S&P 500 UCITS ETF USD Distributing', 'XLE': 'Energy Select Sector SPDR Fund', 'XLV': 'Health Care Select Sector SPDR Fund', 'XLY': 'Consumer Discretionary Select Sector SPDR Fund', 'XLI': 'Industrial Select Sector SPDR Fund', 'XLB': 'Materials Select Sector SPDR Fund', 'XLU': 'Utilities Select Sector SPDR Fund', 'XLRE': 'Real Estate Select Sector SPDR Fund', 'XLC': 'Communication Services Select Sector SPDR Fund', 'XLP': 'Consumer Staples Select Sector SPDR Fund', 'TLT': 'iShares 20+ Year Treasury Bond ETF', 'IEF': 'iShares 7-10 Year Treasury Bond ETF', 'SHY': 'iShares 1-3 Year Treasury Bond ETF', 'TIP': 'iShares TIPS Bond ETF', 'LQD': 'iShares iBoxx $ Investment Grade Corporate Bond ETF', 'HYG': 'iShares iBoxx $ High Yield Corporate Bond ETF', 'JNK': 'SPDR Bloomberg High Yield Bond ETF', 'EEM': 'iShares MSCI Emerging Markets ETF', 'FXI': 'iShares China Large-Cap ETF', 'EWJ': 'iShares MSCI Japan ETF', 'EWT': 'iShares MSCI Taiwan ETF', 'EWG': 'iShares MSCI Germany ETF', 'EWU': 'iShares MSCI United Kingdom ETF', 'EWZ': 'iShares MSCI Brazil ETF', 'EWH': 'iShares MSCI Hong Kong ETF', 'EWY': 'iShares MSCI South Korea ETF', 'EWS': 'iShares MSCI Singapore ETF', 'EWQ': 'iShares MSCI France ETF', 'EWA': 'iShares MSCI Australia ETF', 'EWP': 'iShares MSCI Spain ETF', 'EWL': 'iShares MSCI Switzerland ETF', 'EWO': 'iShares MSCI Austria ETF', 'ARKK': 'ARK Innovation ETF', 'ARKW': 'ARK Next Generation Internet ETF', 'ARKG': 'ARK Genomic Revolution ETF', 'ARKQ': 'ARK Autonomous Technology & Robotics ETF', 'ARKF': 'ARK Fintech Innovation ETF', 'ARKU': 'ARK Space Exploration & Innovation ETF', 'TQQQ': 'ProShares UltraPro QQQ', 'SQQQ': 'ProShares UltraPro Short QQQ', 'UPRO': 'ProShares UltraPro S&P500', 'SPXU': 'ProShares UltraPro Short S&P500', 'TNA': 'Direxion Daily Small Cap Bull 3X Shares', 'TZA': 'Direxion Daily Small Cap Bear 3X Shares', 'SOXL': 'Direxion Daily Semiconductor Bull 3X Shares', 'SOXS': 'Direxion Daily Semiconductor Bear 3X Shares', 'LABU': 'Direxion Daily S&P Biotech Bull 3X Shares', 'LABD': 'Direxion Daily S&P Biotech Bear 3X Shares', 'NUGT': 'Direxion Daily Gold Miners Index Bull 2X Shares', 'DUST': 'Direxion Daily Gold Miners Index Bear 2X Shares', 'BITO': 'ProShares Bitcoin Strategy ETF', 'GBTC': 'Grayscale Bitcoin Trust ETF', 'DVY': 'iShares Select Dividend ETF', 'SDY': 'SPDR S&P Dividend ETF', 'RDVY': 'First Trust Rising Dividend Achievers ETF', 'VIGI': 'Vanguard International Dividend Appreciation ETF', 'JEPI': 'JPMorgan Equity Premium Income ETF', 'JEPQ': 'JPMorgan Nasdaq Equity Premium Income ETF', 'SPYI': 'NEOS S&P 500 High Income ETF', 'DIVO': 'Amplify CWP Enhanced Dividend Income ETF', 'XDTE': 'Roundhill S&P 500 0DTE Covered Call Strategy ETF', 'XYLD': 'Global X S&P 500 Covered Call ETF', 'RYLD': 'Global X Russell 2000 Covered Call ETF', 'SRLN': 'SPDR Blackstone Senior Loan ETF', 'FLOT': 'iShares Floating Rate Bond ETF', 'MINT': 'PIMCO Enhanced Short Maturity Active ETF', 'JPST': 'JPMorgan Ultra-Short Income ETF', 'BIL': 'SPDR Bloomberg 1-3 Month T-Bill ETF', 'ICSH': 'iShares Ultra Short-Term Bond ETF', 'TFI': 'SPDR Nuveen Bloomberg Short Term Municipal Bond ETF', 'PFF': 'iShares Preferred and Income Securities ETF', 'PSP': 'Invesco Global Listed Private Equity ETF', 'REET': 'iShares Global REIT ETF', 'VNQ': 'Vanguard Real Estate ETF', 'IYR': 'iShares U.S. Real Estate ETF', 'SCHH': 'Schwab U.S. REIT ETF', 'FREL': 'Fidelity MSCI Real Estate Index ETF', 'KBWY': 'Invesco KBW Premium Yield Equity REIT ETF', 'ICF': 'iShares Cohen & Steers REIT ETF', 'ITA': 'iShares U.S. Aerospace & Defense ETF', 'PPA': 'Invesco Aerospace & Defense ETF', 'XAR': 'SPDR S&P Aerospace & Defense ETF', 'DFJ': 'WisdomTree Japan Hedged Equity Fund', 'KWEB': 'KraneShares CSI China Internet ETF', 'FLIN': 'Franklin FTSE India ETF', 'INDA': 'iShares MSCI India ETF', 'EIDO': 'iShares MSCI Indonesia ETF', 'THD': 'iShares MSCI Thailand ETF', 'EPHE': 'iShares MSCI Philippines ETF', 'ECH': 'iShares MSCI Chile ETF', 'ILF': 'iShares Latin America 40 ETF', 'EWIV': 'iShares MSCI Israel ETF', 'ASHR': 'Xtrackers Harvest CSI 300 China A-Shares ETF', 'MCHI': 'iShares MSCI China ETF', 'TAWK': 'iShares MSCI ACWI ex U.S. ETF', 'RSX': 'VanEck Russia ETF', 'EURL': 'Direxion Daily FTSE Europe Bull 3X Shares', 'VGK': 'Vanguard FTSE Europe ETF', 'VG': 'Vanguard Mega Cap ETF', 'ACWX': 'iShares MSCI ACWI ex U.S. ETF', 'IXUS': 'iShares Core MSCI Total International Stock ETF', 'SCHE': 'Schwab Emerging Markets Equity ETF', 'VPL': 'Vanguard FTSE Pacific ETF', 'VSS': 'Vanguard FTSE All-World ex-US Small-Cap ETF', 'DEM': 'WisdomTree Emerging Markets High Dividend Fund', 'DGS': 'WisdomTree Emerging Markets SmallCap Dividend Fund', 'EDIV': 'SPDR S&P Emerging Asia Pacific ETF', 'DVYE': 'iShares Emerging Markets Dividend ETF', 'DWM': 'WisdomTree International Equity Fund', 'PIE': 'Invesco DWA Emerging Markets Momentum ETF', 'PXF': 'Invesco RAFI Developed Markets ex-U.S. ETF', 'SPDW': 'SPDR Portfolio Developed World ex-US ETF', 'GXG': 'Global X MSCI Colombia ETF', 'FEM': 'First Trust Emerging Markets AlphaDEX Fund', 'AFK': 'VanEck Africa Index ETF', 'NGE': 'Global X MSCI Nigeria ETF', 'LIT': 'Global X Lithium & Battery Tech ETF', 'REMX': 'VanEck Rare Earth/Strategic Metals ETF', 'TAN': 'Invesco Solar ETF', 'ICLN': 'iShares Global Clean Energy ETF', 'FAN': 'First Trust Global Wind Energy ETF', 'PBD': 'Invesco Global Clean Energy ETF', 'CQQQ': 'Invesco China Technology ETF', 'KARS': 'KraneShares Electric Vehicles and Future Mobility ETF', 'BUG': 'Global X Cybersecurity ETF', 'HACK': 'ETFMG Prime Cyber Security ETF', 'WCBR': 'WisdomTree Cybersecurity Fund', 'AIQ': 'Global X Artificial Intelligence & Technology ETF', 'BOTZ': 'Global X Robotics & Artificial Intelligence ETF', 'ROBO': 'ROBO Global Robotics and Automation Index ETF', 'IRBO': 'iShares Robotics and Artificial Intelligence Multisector ETF', 'THNQ': 'ROBO Global Artificial Intelligence ETF', 'QTEC': 'First Trust NASDAQ-100-Technology Sector Index Fund', 'FTEC': 'Fidelity MSCI Information Technology Index ETF', 'IYW': 'iShares U.S. Technology ETF', 'ROM': 'ProShares Ultra Technology', 'PSI': 'Invesco Dynamic Semiconductors ETF', 'SMH': 'VanEck Semiconductor ETF', 'XSD': 'SPDR S&P Semiconductor ETF', 'SSG': 'Direxion Daily Semiconductor Bear 3X Shares', 'FTXL': 'First Trust Nasdaq Semiconductor ETF', 'XME': 'SPDR S&P Metals & Mining ETF', 'SLX': 'VanEck Steel ETF', 'PICK': 'iShares MSCI Global Metals & Mining Producers ETF', 'XHB': 'SPDR S&P Homebuilders ETF', 'IYT': 'iShares U.S. Transportation ETF', 'XTN': 'SPDR S&P Transportation ETF', 'CARZ': 'First Trust NASDAQ Global Auto Index Fund', 'DRIV': 'Global X Autonomous & Electric Vehicles ETF', 'IDRV': 'iShares Self-Driving EV and Tech ETF', 'EVLV': 'Invesco Electric Vehicle Metals ETF', 'BATT': 'Amplify Lithium & Battery Technology ETF', 'ALMM': 'Horizons Global Lithium Producers Index ETF', 'TMDX': 'Alpha Architect Tail Risk ETF', 'IDNA': 'iShares Genomics Immunology and Healthcare ETF', 'XBI': 'SPDR S&P Biotech ETF', 'IBB': 'iShares Biotechnology ETF', 'PSCH': 'Invesco S&P SmallCap Health Care ETF', 'PJP': 'Invesco Dynamic Leisure and Entertainment ETF', 'XPH': 'SPDR S&P Pharmaceuticals ETF', 'VHT': 'Vanguard Health Care ETF', 'FHLC': 'Fidelity MSCI Health Care Index ETF', 'IXJ': 'iShares Global Healthcare ETF', 'IHI': 'iShares U.S. Medical Devices ETF', 'XHE': 'SPDR S&P Health Care Equipment ETF', 'SBIO': 'ALPS Medical Breakthroughs ETF', 'GNOM': 'Global X Genomics & Biotechnology ETF', 'EDOC': 'Global X Telemedicine & Digital Health ETF', 'CURE': 'Direxion Daily Healthcare Bull 3X Shares', 'RXD': 'ProShares UltraShort Health Care', 'BIS': 'ProShares UltraShort Nasdaq Biotechnology', 'DIRT': 'Daily Gold Miners Index Bear 3X Shares', 'SOIL': 'Direxion Daily Natural Gas Related Bull 2X Shares', 'URA': 'Global X Uranium ETF', 'NLR': 'VanEck Uranium+Nuclear Energy ETF', 'PUI': 'Invesco DWA Utilities Momentum ETF', 'FFTY': 'Innovator IBD 50 ETF', 'KURE': 'Global X Uranium ETF', 'MJ': 'Amplify Alternative Harvest ETF', 'YOLO': 'AdvisorShares Pure Cannabis ETF', 'TOKE': 'AdvantageShares Cannabis ETF', 'MSOS': 'AdvisorShares Pure US Cannabis ETF', 'YINN': 'Direxion Daily FTSE China Bull 3X Shares', 'YANG': 'Direxion Daily FTSE China Bear 3X Shares', 'BOIL': 'ProShares Ultra Bloomberg Natural Gas', 'KOLD': 'ProShares UltraShort Bloomberg Natural Gas', 'UCO': 'ProShares Ultra Bloomberg Crude Oil', 'SCO': 'ProShares UltraShort Bloomberg Crude Oil', 'USO': 'United States Oil Fund', 'BNO': 'United States Brent Oil Fund', 'DBA': 'Invesco DB Agriculture Fund', 'DJP': 'iPath Series B Bloomberg Commodity ETF', 'PDBC': 'Invesco Optimum Yield Diversified Commodity Strategy No K-1 ETF', 'GUNR': 'FlexShares Global Upstream Natural Resources ETF', 'NANR': 'FlexShares Morningstar Global Energy Sector Index Fund', 'WOOD': 'iShares S&P Global Timber & Forestry Index Fund', 'CUT': 'Invesco MSCI Global Timber ETF',

        };

        async function fetchStockData(symbol) {
            try {
                const response = await fetch(`${API_BASE_URL}/stocks?symbol=${symbol}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Calculate intrinsic values using different models
                const dcfValue = calculateDCFValue(data);
                const peValue = calculatePEValue(data);
                const assetValue = calculateAssetValue(data);
                
                // Calculate average intrinsic value and status
                const values = [
                    { value: dcfValue, weight: 0.55 },
                    { value: peValue, weight: 0.30 },
                    { value: assetValue, weight: 0.15 }
                ].filter(v => v.value > 0);
                
                let avgIntrinsicValue = 0;
                let percentDiff = 0;
                
                if (values.length > 0) {
                    const totalWeight = values.reduce((sum, v) => sum + v.weight, 0);
                    
                    avgIntrinsicValue = values.reduce((sum, v) => {
                        return sum + (v.value * (v.weight / totalWeight));
                    }, 0);

                    percentDiff = ((avgIntrinsicValue - data.currentPrice) / data.currentPrice) * 100;
                }
                
                const status = Math.abs(percentDiff) < 10 ? "Fair Value" : 
                    percentDiff > 20 ? "Undervalued" : "Overvalued";

                return {
                    name: companyNames[symbol] || symbol,
                    ticker: symbol,
                    dcfValue: dcfValue,
                    peValue: peValue,
                    assetValue: assetValue,
                    currentPrice: data.currentPrice,
                    status: status,
                    percentDiff: percentDiff,
                    rawData: data // Store raw data for debugging
                };
            } catch (error) {
                console.error(`Error fetching data for ${symbol}:`, error);
                return {
                    name: companyNames[symbol] || symbol,
                    ticker: symbol,
                    dcfValue: 0,
                    peValue: 0,
                    assetValue: 0,
                    currentPrice: 0,
                    status: "API Error",
                    percentDiff: 0
                };
            }
        }

        function calculateDCFValue(data) {
            const { freeCashflow, sharesOutstanding, netdebt, eps, profitMargins, beta } = data;
            
            const growthRates = data.growthRates || [0.0516, 0.0435, 0.04, 0.035, 0.03]; // Tapering growth rates
            const terminalGrowth = data.terminalGrowth || 0.025; // 2.5%
            const discountRate = data.wacc || 0.0633; // Specific WACC for JNJ; fallback to provided or calculated
            
            
            if (!freeCashflow || !sharesOutstanding) {
                const growthRate = 0.05;
                const fallbackDiscountRate = 0.1;
                const projectedEPS = eps * Math.pow(1 + growthRate, 5);
                const terminalValue = projectedEPS / (fallbackDiscountRate - 0.02);
                return terminalValue * 0.8;
            }
            
            let currentFCF = freeCashflow;
            let enterpriseValue = 0;
            
            for (let year = 1; year <= 5; year++) {
                currentFCF *= (1 + growthRates[year - 1]);
                const pv = currentFCF / Math.pow(1 + discountRate, year);
                enterpriseValue += pv;
            }

            const terminalFCF = currentFCF * (1 + terminalGrowth);
            const terminalValue = terminalFCF / (discountRate - terminalGrowth);
            const pvTerminalValue = terminalValue / Math.pow(1 + discountRate, 5);
            
            
            enterpriseValue += pvTerminalValue;
            
            const equityValue = enterpriseValue - netdebt;
            
            const valuePerShare = equityValue / sharesOutstanding;
            
            return valuePerShare;

        }


        function calculatePEValue(data) {
            const {trailingPE, forwardPE, epsGrowth, currentPrice, epsTTM, pegRatio = null} = data;
            
            if (!trailingPE || !forwardPE || !epsGrowth || !epsTTM) {
                return currentPrice * 0.9;}
            
            if (trailingPE <= 0 || forwardPE <= 0 || epsTTM <= 0) {
                return currentPrice * 0.9;}
            
            let calculatedPEG;
            
            if (pegRatio && pegRatio > 0) {calculatedPEG = pegRatio;} 
            else {
                const growthRatePercent = epsGrowth * 100;
                calculatedPEG = trailingPE / growthRatePercent;
            }
            
            const expectedGrowthRate = trailingPE / calculatedPEG;
            
            const growthBasedFairPE = expectedGrowthRate;
            
            const blendedPE = (0.4 * trailingPE) + (0.6 * forwardPE);
            
            const fairPE = (blendedPE + growthBasedFairPE) / 2;
            
            const boundedFairPE = Math.min(50, Math.max(8, fairPE));
            
            const fairValue = epsTTM * boundedFairPE;
            
            const peValue = fairValue * 0.8;
            
            return peValue;
    }

        function calculateAssetValue(data) {
            const {
                bookValue,
                totalRevenue,
                sharesOutstanding,
                currentPrice,
                trailingPE,
                roe,
                revenueGrowth = 0.1, // default 10%
                discountRate = 0.1   // default 10%
                } = data;
            
            if (!sharesOutstanding || sharesOutstanding <= 0) {
                return currentPrice * 0.8; // fallback
            }
            
            const bookPerShare = bookValue || 0;
            const revenuePerShare = totalRevenue ? totalRevenue / sharesOutstanding : 0;
            const eps = trailingPE;
            
            let assetValue = 0;
            
            if (bookPerShare > 0 && roe) {
                assetValue = bookPerShare * (1 + roe);
            } else if (revenuePerShare > 0) {
                const projectedRevenue = revenuePerShare * Math.pow(1 + revenueGrowth, 5);
                assetValue = projectedRevenue / Math.pow(1 + discountRate, 5);
            } else if (eps > 0) {
                assetValue = eps * 15;
            } else {
                assetValue = currentPrice * 0.8; // fallback
            }
            
            return assetValue

        }

        
        // Enhanced Dividend Discount Model
        function calculateDDMValue(data) {
            const { dividendRate, dividendYield, currentPrice, beta } = data;
            
            if (!dividendRate || dividendRate <= 0) {
                // For non-dividend stocks, estimate based on earnings
                return data.eps * 12; // Simple earnings multiple
            }
            
            const dividendGrowthRate = Math.max(0.01, Math.min(0.08, 0.03)); // 1-8% growth
            const requiredReturn = 0.04 + (beta || 1) * 0.06; // Risk-adjusted return
            
            if (requiredReturn <= dividendGrowthRate) {
                return currentPrice * 1.1; // Fallback if model breaks down
            }
            
            return (dividendRate * (1 + dividendGrowthRate)) / (requiredReturn - dividendGrowthRate);
        }

        // Fetch all stock data
        async function fetchAllStockData() {
            const promises = stockSymbols.map(symbol => fetchStockData(symbol));
            const results = await Promise.allSettled(promises);
            
            return results.map((result, index) => {
                if (result.status === 'fulfilled') {
                    return result.value;
                } else {
                    console.error(`Failed to fetch ${stockSymbols[index]}:`, result.reason);
                    return {
                        name: companyNames[stockSymbols[index]] || stockSymbols[index],
                        ticker: stockSymbols[index],
                        dcfValue: 0,
                        peValue: 0,
                        assetValue: 0,
                        currentPrice: 0,
                        status: "Network Error",
                        percentDiff: 0
                    };
                }
            });
        }

        function formatCurrency(value) {
            return "$" + value.toFixed(2);
        }

        function formatPercentage(value) {
            return (value > 0 ? "+" : "") + value.toFixed(1) + "%";
        }

        function renderTable() {
            const tbody = document.getElementById('stockTableBody');
            
            if (stockData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="loading"><div class="spinner"></div>Loading stock data...</td></tr>';
                return;
            }

            tbody.innerHTML = stockData.map(stock => {
                const percentClass = stock.percentDiff > 0 ? 'positive' : 'negative';
                const statusClass = stock.status === 'Undervalued' ? 'status-undervalued' : 'status-overvalued';
                
                return `
                    <tr>
                        <td>${stock.name}</td>
                        <td class="ticker">${stock.ticker}</td>
                        <td class="price">${formatCurrency(stock.dcfValue)}</td>
                        <td class="price">${formatCurrency(stock.peValue)}</td>
                        <td class="price">${formatCurrency(stock.assetValue)}</td>
                        <td class="price">${formatCurrency(stock.currentPrice)}</td>
                        <td><span class="${statusClass}">${stock.status}</span></td>
                        <td class="percentage ${percentClass}">${formatPercentage(stock.percentDiff)}</td>
                    </tr>
                `;
            }).join('');
        }

        function sortTable(columnIndex) {
            if (sortColumn === columnIndex) {
                sortDirection *= -1;
            } else {
                sortColumn = columnIndex;
                sortDirection = -1;
            }

            const keys = ['name', 'ticker', 'dcfValue', 'peValue', 'assetValue', 'currentPrice', 'status', 'percentDiff'];
            const key = keys[columnIndex];

            stockData.sort((a, b) => {
                let aVal = a[key];
                let bVal = b[key];

                // Handle numeric vs string comparison
                if (typeof aVal === 'string' && typeof bVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (aVal < bVal) return -1 * sortDirection;
                if (aVal > bVal) return 1 * sortDirection;
                return 0;
            });

            renderTable();
            updateSortArrows();
        }

        function updateSortArrows() {
            const arrows = document.querySelectorAll('.sort-arrow');
            arrows.forEach((arrow, index) => {
                if (index === sortColumn) {
                    arrow.textContent = sortDirection === -1 ? 'â†“' : 'â†‘';
                } else {
                    arrow.textContent = 'â†•';
                }
            });
        }

        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#stockTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function refreshData() {
            // Show loading state
            document.getElementById('stockTableBody').innerHTML = 
                '<tr><td colspan="8" class="loading"><div class="spinner"></div>Fetching real-time data from Yahoo Finance...</td></tr>';
            
            // Fetch real data from Yahoo Finance
            fetchAllStockData()
                .then(data => {
                    stockData = data;
                    sortTable(sortColumn);
                })
                .catch(error => {
                    console.error('Error fetching stock data:', error);
                    document.getElementById('stockTableBody').innerHTML = 
                        '<tr><td colspan="8" class="loading" style="color: #f87171;">Error loading data. Please try again or check console for details.</td></tr>';
                });
        }

        // Initialize the application
        function init() {
            // Load initial data from Yahoo Finance
            refreshData();
            
            // Set up search functionality
            document.getElementById('searchInput').addEventListener('input', filterTable);
        }

        // Start the application
        init();
    </script>
</body>
</html>

















